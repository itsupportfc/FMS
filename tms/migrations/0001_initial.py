# Generated by Django 6.0.1 on 2026-01-26 17:00

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Broker',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('mc_number', models.CharField(help_text='Motor Carrier Number', max_length=20, unique=True)),
                ('primary_contact_name', models.CharField(max_length=100)),
                ('primary_phone', models.CharField(max_length=20)),
                ('primary_email', models.EmailField(max_length=254)),
                ('notes', models.TextField(blank=True)),
                ('credit_history', models.TextField(blank=True, help_text='Credit history notes')),
                ('average_payment_days', models.FloatField(blank=True, help_text='Average payment days', null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Facility',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('facility_type', models.CharField(choices=[('shipper', 'Shipper'), ('receiver', 'Receiver (Consignee)')], max_length=10)),
                ('address_line1', models.CharField(max_length=200)),
                ('address_line2', models.CharField(blank=True, max_length=200)),
                ('city', models.CharField(max_length=100)),
                ('state', models.CharField(help_text='US state abbreviation', max_length=2)),
                ('zip_code', models.CharField(max_length=10)),
                ('contact_name', models.CharField(max_length=100)),
                ('phone', models.CharField(max_length=20)),
                ('appointment_required', models.BooleanField(default=True)),
                ('hours_of_operation', models.CharField(default='24/7', help_text='e.g., Mon-Fri 8am-5pm', max_length=100)),
                ('notes', models.TextField(blank=True, help_text='Special instructions, dock info, etc.')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Carrier',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('mc_number', models.CharField(help_text='Motor Carrier Number', max_length=20, unique=True)),
                ('dot_number', models.CharField(help_text='USDOT Number', max_length=20, unique=True)),
                ('carrier_type', models.CharField(choices=[('company', 'Trucking Company'), ('owner_operator', 'Owner-Operator')], max_length=20)),
                ('primary_contact_name', models.CharField(max_length=100)),
                ('primary_phone', models.CharField(max_length=20)),
                ('primary_email', models.EmailField(max_length=254)),
                ('address_line1', models.CharField(max_length=200)),
                ('address_line2', models.CharField(blank=True, max_length=200)),
                ('city', models.CharField(max_length=100)),
                ('state', models.CharField(max_length=2)),
                ('zip_code', models.CharField(max_length=10)),
                ('notes', models.TextField(blank=True)),
                ('carrier_has_insurance', models.BooleanField(default=True, help_text='Does this carrier have valid insurance?')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='carriers_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Driver',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('first_name', models.CharField(max_length=50)),
                ('last_name', models.CharField(max_length=50)),
                ('phone', models.CharField(max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('cdl_number', models.CharField(help_text="Commercial Driver's License (required for operations)", max_length=50, unique=True)),
                ('cdl_expiration', models.DateField(blank=True, help_text='CDL expiration date', null=True)),
                ('hos_cycle', models.CharField(choices=[('60_7', '60 hours/7 days'), ('70_8', '70 hours/8 days')], default='60_7', max_length=10)),
                ('notes', models.TextField(blank=True)),
                ('carrier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='drivers', to='tms.carrier')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Load',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('load_id', models.CharField(help_text="Broker's load/reference number", max_length=50, unique=True, verbose_name='Broker Load ID')),
                ('commodity_type', models.CharField(blank=True, max_length=100, null=True)),
                ('weight', models.PositiveIntegerField(blank=True, null=True)),
                ('miles', models.PositiveIntegerField(blank=True, help_text='Total loaded miles', null=True)),
                ('rate', models.DecimalField(blank=True, decimal_places=2, help_text='Total rate in USD', max_digits=10, null=True)),
                ('rpm', models.DecimalField(decimal_places=2, editable=False, help_text='Rate Per Mile (auto-calculated)', max_digits=5, null=True)),
                ('commission_type', models.CharField(blank=True, choices=[('percentage', 'Percentage of Rate'), ('fixed', 'Fixed Amount')], default='percentage', help_text='How you receive payment from carrier', max_length=20, null=True)),
                ('dispatcher_commission', models.DecimalField(blank=True, decimal_places=2, help_text='Percentage (e.g., 85.00 for 85%) or fixed amount in USD', max_digits=10, null=True)),
                ('status', models.CharField(choices=[('booked', 'Booked'), ('dispatched', 'Dispatched'), ('in_transit', 'In Transit'), ('delivered', 'Delivered'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='booked', max_length=20)),
                ('dispatched_at', models.DateTimeField(blank=True, help_text='When assigned to carrier/truck/driver', null=True)),
                ('delivered_at', models.DateTimeField(blank=True, help_text='When delivery was completed', null=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When load was closed', null=True)),
                ('cancelled_at', models.DateTimeField(blank=True, help_text="When load was cancelled or TONU'd", null=True)),
                ('remarks', models.TextField(blank=True)),
                ('broker', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.broker')),
                ('carrier', models.ForeignKey(blank=True, help_text='Assigned during dispatch', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.carrier')),
                ('dispatcher', models.ForeignKey(help_text='Dispatcher who booked this load', on_delete=django.db.models.deletion.PROTECT, related_name='dispatched_loads', to=settings.AUTH_USER_MODEL)),
                ('driver', models.ForeignKey(blank=True, help_text='Assigned during dispatch', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.driver')),
                ('tracking_agent', models.ForeignKey(blank=True, help_text='Tracking agent assigned after handover from dispatch', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tracked_loads', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Handover',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('special_instructions', models.TextField(blank=True)),
                ('remarks', models.TextField(blank=True)),
                ('from_agent', models.ForeignKey(help_text='Dispatcher who handed over (immutable audit)', on_delete=django.db.models.deletion.PROTECT, related_name='handovers_from', to=settings.AUTH_USER_MODEL)),
                ('to_agent', models.ForeignKey(help_text='Tracking agent assigned to load', on_delete=django.db.models.deletion.PROTECT, related_name='handovers_to', to=settings.AUTH_USER_MODEL)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='handovers', to='tms.load')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Accessorial',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('charge_type', models.CharField(choices=[('detention', 'Detention'), ('layover', 'Layover'), ('tonu', 'TONU'), ('lumper', 'Lumper'), ('other', 'Other')], max_length=20)),
                ('amount', models.DecimalField(blank=True, decimal_places=2, help_text='Amount in USD. Leave blank for manager to calculate.', max_digits=10, null=True)),
                ('description', models.TextField(blank=True)),
                ('manager_approved', models.BooleanField(default=False)),
                ('broker_approved', models.BooleanField(default=False)),
                ('detention_start', models.DateTimeField(blank=True, null=True)),
                ('detention_end', models.DateTimeField(blank=True, null=True)),
                ('detention_billed_hours', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('layover_start_date', models.DateField(blank=True, null=True)),
                ('layover_end_date', models.DateField(blank=True, null=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_accessorials', to=settings.AUTH_USER_MODEL)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='accessorials', to='tms.load')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='LoadDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('document_type', models.CharField(choices=[('RC', 'Rate Confirmation'), ('BOL', 'Bill of Lading'), ('POD', 'Proof of Delivery'), ('DETENTION', 'Detention'), ('LUMPER', 'Lumper'), ('TONU', 'Truck Order Not Used'), ('OTHER', 'Other')], default='OTHER', max_length=20)),
                ('file', models.FileField(upload_to='documents/%Y/%m/%d/')),
                ('original_filename', models.CharField(blank=True, max_length=255)),
                ('description', models.TextField(blank=True)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='tms.load')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='LoadStop',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('stop_type', models.CharField(choices=[('pickup', 'Pickup'), ('delivery', 'Delivery')], help_text='Pickup or Delivery', max_length=10)),
                ('sequence', models.PositiveIntegerField(help_text='Route order: 1,2,3 ..(important for routing)')),
                ('appt_start', models.DateTimeField(blank=True, help_text='Appointment window start time (preferred for real ops)', null=True)),
                ('appt_end', models.DateTimeField(blank=True, help_text='Appointment window end time (preferred for real ops)', null=True)),
                ('appointment_type', models.CharField(choices=[('appt', 'Appointment'), ('fcfs', 'First Come First Serve')], default='appt', max_length=10)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('completed', 'Completed'), ('skipped', 'Skipped')], default='pending', max_length=20)),
                ('arrived_at', models.DateTimeField(blank=True, help_text='When truck physically arrived at this stop', null=True)),
                ('departed_at', models.DateTimeField(blank=True, help_text='When truck physically departed this stop', null=True)),
                ('reference_number', models.CharField(blank=True, help_text='PO#, BOL#, Delivery#, etc. specific to this stop', max_length=50)),
                ('pieces', models.PositiveIntegerField(blank=True, help_text='Pieces/pallets for this stop only', null=True)),
                ('weight', models.PositiveIntegerField(blank=True, help_text='Weight for this stop only', null=True)),
                ('special_instructions', models.TextField(blank=True, help_text='Dock#, gate code, contact name, check-in process, etc.')),
                ('notes', models.TextField(blank=True)),
                ('facility', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='load_stops', to='tms.facility')),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='stops', to='tms.load')),
            ],
            options={
                'ordering': ['sequence'],
            },
        ),
        migrations.CreateModel(
            name='RescheduleRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('original_appt_start', models.DateTimeField(blank=True, null=True)),
                ('original_appt_end', models.DateTimeField(blank=True, null=True)),
                ('requested_appt_start', models.DateTimeField(blank=True, null=True)),
                ('requested_appt_end', models.DateTimeField(blank=True, null=True)),
                ('reason', models.CharField(choices=[('shipper_delay', 'Shipper - Facility Not Ready'), ('receiver_delay', 'Receiver - Facility Full/Busy'), ('driver_hos', 'Driver - Out of Hours (HOS)'), ('mechanical', 'Driver - Mechanical Breakdown'), ('weather', 'Environmental - Weather/Road Closure'), ('traffic', 'Environmental - Heavy Traffic/Accident'), ('broker_req', 'Broker - Requested Change'), ('doc_error', 'Administrative - Rate Con/Paperwork Error'), ('missed_appt', 'Operational - Driver Missed Appointment')], help_text='Why is rescheduling needed?', max_length=20)),
                ('consignee_approved', models.BooleanField(default=False, help_text='Has consignee approved? Write contact Details in notes.')),
                ('broker_approved', models.BooleanField(default=False, help_text='Has broker approved?')),
                ('manager_approved', models.BooleanField(default=False, help_text='Has internal manager approved?')),
                ('remarks', models.TextField(blank=True, help_text='Write all details here')),
                ('created_by', models.ForeignKey(help_text='Tracking agent who initiated reschedule', on_delete=django.db.models.deletion.PROTECT, related_name='created_reschedules', to=settings.AUTH_USER_MODEL)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reschedule_requests', to='tms.load')),
                ('stop', models.ForeignKey(help_text='The specific stop for which the reschedule is requested', on_delete=django.db.models.deletion.PROTECT, related_name='reschedule_requests', to='tms.loadstop')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TrackingUpdate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('current_location', models.CharField(blank=True, help_text="Current location description (e.g., 'I-80 exit 42')", max_length=200)),
                ('tracking_method', models.CharField(choices=[('phone', 'Phone Call'), ('text', 'Text Message'), ('email', 'Email')], max_length=20)),
                ('is_delayed', models.BooleanField(default=False)),
                ('delay_reason', models.CharField(blank=True, choices=[('shipper_delay', 'Shipper - Facility Not Ready'), ('receiver_delay', 'Receiver - Facility Full/Busy'), ('driver_hos', 'Driver - Out of Hours (HOS)'), ('mechanical', 'Driver - Mechanical Breakdown'), ('weather', 'Environmental - Weather/Road Closure'), ('traffic', 'Environmental - Heavy Traffic/Accident'), ('broker_req', 'Broker - Requested Change'), ('doc_error', 'Administrative - Rate Con/Paperwork Error'), ('missed_appt', 'Operational - Driver Missed Appointment'), ('other', 'Other')], max_length=20)),
                ('new_eta', models.DateTimeField(blank=True, help_text='If delayed, enter new estimated delivery time', null=True, verbose_name='Proposed New ETA')),
                ('notes', models.TextField(blank=True)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tracking_updates', to='tms.load')),
                ('tracking_agent', models.ForeignKey(help_text='Tracking agent who reported this update (immutable audit)', on_delete=django.db.models.deletion.PROTECT, related_name='tracking_updates', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Truck',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('truck_number', models.CharField(help_text='Internal fleet number', max_length=50)),
                ('trailer_number', models.CharField(blank=True, help_text='Trailer number if applicable', max_length=50)),
                ('vin', models.CharField(blank=True, help_text='Vehicle Identification Number', max_length=17)),
                ('license_plate', models.CharField(help_text='License plate number (required for road operations)', max_length=20)),
                ('equipment_type', models.CharField(choices=[('dry_van', 'Dry Van'), ('reefer', 'Refrigerated (Reefer)'), ('flatbed', 'Flatbed'), ('step_deck', 'Step Deck'), ('power_only', 'Power Only'), ('box_truck', 'Box Truck'), ('other', 'Other')], max_length=20)),
                ('length_feet', models.PositiveIntegerField(default=53, help_text='Trailer length (48 or 53)')),
                ('chassis_no', models.CharField(blank=True, help_text='Chassis/frame number (tractor unit identifier)', max_length=50)),
                ('current_status', models.CharField(choices=[('available', 'Available (Empty)'), ('assigned', 'Assigned to Load'), ('out_of_service', 'Out of Service')], default='available', help_text='Current operational status', max_length=20)),
                ('current_location_city', models.CharField(blank=True, max_length=100)),
                ('current_location_state', models.CharField(blank=True, max_length=2)),
                ('last_location_update', models.DateTimeField(blank=True, null=True)),
                ('truck_has_insurance', models.BooleanField(default=True, help_text='Does this truck have valid insurance?')),
                ('notes', models.TextField(blank=True)),
                ('carrier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trucks', to='tms.carrier')),
            ],
        ),
        migrations.AddField(
            model_name='load',
            name='truck',
            field=models.ForeignKey(blank=True, help_text='Assigned during dispatch', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.truck'),
        ),
        migrations.CreateModel(
            name='DutyLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('status', models.CharField(choices=[('off_duty', 'Off Duty'), ('sleeper_berth', 'Sleeper Berth'), ('driving', 'Driving'), ('on_duty_not_driving', 'On Duty (Not Driving)'), ('yard_move', 'Yard Move'), ('personal', 'Personal Conveyance')], max_length=25)),
                ('start_time', models.DateTimeField()),
                ('end_time', models.DateTimeField(blank=True, null=True)),
                ('current_location', models.CharField(blank=True, help_text="Freeform location (e.g., 'I-80 exit 42, IA')", max_length=200)),
                ('remarks', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_duty_logs', to=settings.AUTH_USER_MODEL)),
                ('driver', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='duty_logs', to='tms.driver')),
                ('load', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='duty_logs', to='tms.load')),
                ('truck', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='duty_logs', to='tms.truck')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='driver',
            name='current_truck',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='current_driver', to='tms.truck'),
        ),
        migrations.CreateModel(
            name='CarrierDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('document_type', models.CharField(choices=[('W9', 'W9'), ('INSURANCE_COI', 'Insurance (COI)'), ('AUTHORITY', 'MC / Authority Letter'), ('ACH', 'ACH / Banking Form'), ('LOR', 'Letter of Reference'), ('OTHER', 'Other')], default='OTHER', max_length=30)),
                ('file', models.FileField(upload_to='documents/%Y/%m/%d/')),
                ('original_filename', models.CharField(blank=True, max_length=255)),
                ('description', models.TextField(blank=True)),
                ('carrier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='tms.carrier')),
            ],
            options={
                'constraints': [models.UniqueConstraint(fields=('carrier', 'document_type'), name='unique_document_per_carrier_and_type')],
            },
        ),
        migrations.AddConstraint(
            model_name='loadstop',
            constraint=models.UniqueConstraint(fields=('load', 'sequence'), name='unique_stop_sequence'),
        ),
        migrations.AddConstraint(
            model_name='truck',
            constraint=models.UniqueConstraint(fields=('carrier', 'truck_number'), name='unique_truck_per_carrier'),
        ),
    ]
