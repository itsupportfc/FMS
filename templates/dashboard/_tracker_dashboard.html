<!-- Sticky Header -->
<div class="page-header">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Tracker Dashboard</h1>
            <p class="text-sm text-gray-600 mt-1">Monitor and track your assigned loads</p>
        </div>
    </div>
</div>

<!-- Tracking Agent Dashboard -->
<!-- WHY: Shows loads assigned to this tracker, with focus on actionable items -->

<div class="max-w-[1600px] mx-auto px-8 py-8">
    <div class="mb-8"></div>

    <!-- Stats KPIs -->
    <div class="grid grid-cols-3 gap-6 mb-8">
        <div class="card text-center border-t-4 border-gray-500">
            <div class="text-[13px] font-medium text-gray-500 uppercase tracking-wide mb-2">Total Active</div>
            <div class="text-4xl font-extrabold tracking-tight">{{ active_count }}</div>
            <div class="text-[13px] text-gray-500 mt-2">Loads assigned to you</div>
        </div>

        <div class="card text-center border-t-4 border-blue-500">
            <div class="text-[13px] font-medium text-gray-500 uppercase tracking-wide mb-2">Awaiting Start</div>
            <div class="text-4xl font-extrabold tracking-tight">{{ awaiting_start_count }}</div>
            <div class="text-[13px] text-gray-500 mt-2">Ready to start transit</div>
        </div>

        <div class="card text-center border-t-4 border-amber-500">
            <div class="text-[13px] font-medium text-gray-500 uppercase tracking-wide mb-2">In Transit</div>
            <div class="text-4xl font-extrabold tracking-tight">{{ in_transit_count }}</div>
            <div class="text-[13px] text-gray-500 mt-2">Currently tracking</div>
        </div>
    </div>

    <!-- Active Loads Grid -->
    <div class="grid grid-cols-2 gap-6">
        <!-- Left: Awaiting Start -->
        <div class="card">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Awaiting Start Transit</h3>
                <span class="badge-blue">{{ awaiting_start_count }} loads</span>
            </div>
            <div class="space-y-3 max-h-[560px] overflow-y-auto pr-1">
                {% for load in awaiting_start_loads %}
                    <div class="load-card grid grid-cols-2 gap-3 items-center">

                        <div class="col-span-2 flex justify-between items-center">
                            <span class="font-semibold text-gray-900">{{ load.load_id }}</span>
                            <span class="text-[12px] text-gray-500">{{ load.broker.name }}</span>
                        </div>

                        <div class="col-span-2 text-[14px] text-gray-700">
                            <span class="font-semibold text-gray-900">FROM</span>
                            {{ load.pickup_facility.city }}, {{ load.pickup_facility.state }}
                            →
                            <span class="font-semibold text-gray-900">TO</span>
                            {{ load.delivery_facility.city }}, {{ load.delivery_facility.state }}
                        </div>

                        <a href="{% url 'load_detail' load.load_id %}"
                           class="btn-primary col-span-2 text-center">Start Transit</a>
                    </div>
                {% empty %}
                    <div class="load-card text-center text-gray-500 italic">No loads awaiting start</div>
                {% endfor %}
            </div>
        </div>

        <!-- Right: In Transit -->
        <div class="card">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">In Transit (Active Tracking)</h3>
                <span class="badge-amber">{{ in_transit_count }} loads</span>
            </div>
            <div class="space-y-3 max-h-[560px] overflow-y-auto pr-1">
                {% for load in in_transit_loads %}
                    <div class="load-card grid grid-cols-2 gap-3 items-center">

                        <div class="col-span-2 flex justify-between items-center">
                            <div>
                                <span class="font-semibold text-gray-900">{{ load.load_id }}</span>
                                <div class="text-[12px] text-gray-500 mt-0.5">Driver: {{ load.driver.full_name }}</div>
                            </div>
                            <span class="badge-amber">In Transit</span>
                        </div>

                        <div class="col-span-2 text-[14px] text-gray-700">
                            <span class="font-semibold text-gray-900">FROM</span>
                            {{ load.pickup_facility.city }}, {{ load.pickup_facility.state }}
                            →
                            <span class="font-semibold text-gray-900">TO</span>
                            {{ load.delivery_facility.city }}, {{ load.delivery_facility.state }}
                        </div>

                        <a href="{% url 'load_detail' load.load_id %}"
                           class="btn-secondary col-span-2 text-center">View & Update</a>
                    </div>
                {% empty %}
                    <div class="load-card text-center text-gray-500 italic">No loads in transit</div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
