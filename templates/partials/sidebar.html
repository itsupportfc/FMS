<div id="sidebar"
     class="flex flex-col h-full transition-all duration-300 ease-in-out bg-gray-900 text-white">

    <!-- Header -->
    <div class="h-16 flex items-center justify-between px-4 bg-gray-900 border-b border-gray-800">
        <h2 class="text-xl font-bold text-white tracking-tight whitespace-nowrap sidebar-label">DISPATCH</h2>
        <button id="sidebarToggle"
                type="button"
                aria-label="Toggle sidebar"
                aria-controls="sidebar"
                aria-expanded="true"
                class="p-2 rounded-md hover:bg-gray-800">
            <svg id="toggleIcon"
                 class="w-5 h-5 text-gray-300 transition-transform"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-3 py-4 space-y-1 bg-gray-900 overflow-y-auto">
        {% for item in sidebar_items %}
            {% url item.url as item_url %}
            <a href="{% url item.url %}"
               class="block px-4 py-3 rounded-lg border text-[15px] transition-colors
                      {% if forloop.first %}
                          bg-green-700 border-green-700 text-white font-semibold
                      {% else %}
                          border-gray-800 text-gray-200 hover:bg-gray-800 hover:text-white
                      {% endif %}">
                <span class="sidebar-label">{{ item.label }}</span>
            </a>
        {% endfor %}
    </nav>

    <!-- Footer -->
    <div class="px-3 py-4 border-t border-gray-800 bg-gray-900 space-y-3">
        {% if request.user.is_authenticated %}
            <div class="px-3 py-3 bg-gray-800 border border-gray-700 rounded-lg sidebar-label">
                <p class="text-[15px] font-semibold text-white">{{ request.user.get_full_name|default:request.user.username }}</p>
                <p class="text-[13px] text-gray-400 mt-1">{{ request.user.get_role_display }}</p>
            </div>
        {% endif %}
        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit"
                    class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg hover:bg-gray-700 transition-colors text-gray-200 hover:text-white">
                <span class="sidebar-label">Logout</span>
            </button>
        </form>
    </div>
</div>

<script>
    const sidebar = document.getElementById('sidebar');
    const toggle = document.getElementById('sidebarToggle');
    const icon = document.getElementById('toggleIcon');
    const labels = document.querySelectorAll('.sidebar-label');

    function setSidebar(collapsed) {
        const aside = sidebar.parentElement;

        if (collapsed) {
            aside.classList.replace('w-64', 'w-20');
            labels.forEach(el => el.classList.add('hidden'));
            icon.style.transform = 'rotate(180deg)';
        } else {
            aside.classList.replace('w-20', 'w-64');
            labels.forEach(el => el.classList.remove('hidden'));
            icon.style.transform = 'rotate(0deg)';
        }
        localStorage.setItem('sidebarCollapsed', collapsed);
    }

    toggle.addEventListener('click', () => {
        setSidebar(localStorage.getItem('sidebarCollapsed') !== 'true');
    });

    setSidebar(localStorage.getItem('sidebarCollapsed') === 'true');
</script>
