# Generated by Django 6.0.1 on 2026-01-09 11:26

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Broker',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=200)),
                ('mc_number', models.CharField(help_text='Motor Carrier Number', max_length=20, unique=True)),
                ('primary_contact_name', models.CharField(max_length=100)),
                ('primary_phone', models.CharField(max_length=20)),
                ('primary_email', models.EmailField(max_length=254)),
                ('notes', models.TextField(blank=True)),
                ('credit_history', models.TextField(blank=True, help_text='Credit history notes')),
                ('average_payment_days', models.FloatField(blank=True, help_text='Average payment days', null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Facility',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=200)),
                ('facility_type', models.CharField(choices=[('shipper', 'Shipper'), ('receiver', 'Receiver (Consignee)')], max_length=10)),
                ('address_line1', models.CharField(max_length=200)),
                ('address_line2', models.CharField(blank=True, max_length=200)),
                ('city', models.CharField(max_length=100)),
                ('state', models.CharField(help_text='US state abbreviation', max_length=2)),
                ('zip_code', models.CharField(max_length=10)),
                ('contact_name', models.CharField(max_length=100)),
                ('phone', models.CharField(max_length=20)),
                ('appointment_required', models.BooleanField(default=True)),
                ('hours_of_operation', models.CharField(default='24/7', help_text='e.g., Mon-Fri 8am-5pm', max_length=100)),
                ('notes', models.TextField(blank=True, help_text='Special instructions, dock info, etc.')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Carrier',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('name', models.CharField(max_length=200)),
                ('mc_number', models.CharField(help_text='Motor Carrier Number', max_length=20, unique=True)),
                ('dot_number', models.CharField(help_text='USDOT Number', max_length=20, unique=True)),
                ('carrier_type', models.CharField(choices=[('company', 'Trucking Company'), ('owner_operator', 'Owner-Operator')], max_length=20)),
                ('primary_contact_name', models.CharField(max_length=100)),
                ('primary_phone', models.CharField(max_length=20)),
                ('primary_email', models.EmailField(max_length=254)),
                ('address_line1', models.CharField(max_length=200)),
                ('address_line2', models.CharField(blank=True, max_length=200)),
                ('city', models.CharField(max_length=100)),
                ('state', models.CharField(max_length=2)),
                ('zip_code', models.CharField(max_length=10)),
                ('notes', models.TextField(blank=True)),
                ('carrier_has_insurance', models.BooleanField(default=True, help_text='Does this carrier have valid insurance?')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='carriers_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Driver',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('first_name', models.CharField(max_length=50)),
                ('last_name', models.CharField(max_length=50)),
                ('phone', models.CharField(max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('cdl_number', models.CharField(help_text="Commercial Driver's License (required for operations)", max_length=50, unique=True)),
                ('hos_cycle', models.CharField(choices=[('60_7', '60 hours/7 days'), ('70_8', '70 hours/8 days')], default='60_7', max_length=10)),
                ('is_short_haul_exempt', models.BooleanField(default=False, help_text='150 air-mile short-haul exemption')),
                ('notes', models.TextField(blank=True)),
                ('carrier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='drivers', to='tms.carrier')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Load',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('load_id', models.CharField(help_text="Broker's load/reference number", max_length=50, unique=True, verbose_name='Broker Load ID')),
                ('pickup_date', models.DateField()),
                ('pickup_time', models.TimeField(blank=True, null=True)),
                ('pickup_appointment_type', models.CharField(choices=[('appt', 'Appointment'), ('fcfs', 'First Come First Serve')], default='appt', max_length=10)),
                ('delivery_date', models.DateField()),
                ('delivery_time', models.TimeField(blank=True, null=True)),
                ('delivery_appointment_type', models.CharField(choices=[('appt', 'Appointment'), ('fcfs', 'First Come First Serve')], default='appt', max_length=10)),
                ('miles', models.PositiveIntegerField(help_text='Total loaded miles')),
                ('rate', models.DecimalField(decimal_places=2, help_text='Total rate in USD', max_digits=10)),
                ('rpm', models.DecimalField(decimal_places=2, editable=False, help_text='Rate Per Mile (auto-calculated)', max_digits=5, null=True)),
                ('payment_method', models.CharField(choices=[('percentage', 'Percentage of Rate'), ('fixed', 'Fixed Amount')], default='percentage', help_text='How you receive payment from carrier', max_length=20)),
                ('carrier_payment_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Percentage (e.g., 85.00 for 85%) or fixed amount in USD', max_digits=10, null=True)),
                ('status', models.CharField(choices=[('booked', 'Booked'), ('dispatched', 'Dispatched'), ('at_pickup', 'At Pickup'), ('in_transit', 'In Transit'), ('at_delivery', 'At Delivery'), ('delivered', 'Delivered'), ('completed', 'Completed'), ('cancelled', 'Cancelled'), ('tonu', 'TONU (Truck Ordered Not Used)')], default='booked', max_length=20)),
                ('dispatched_at', models.DateTimeField(blank=True, help_text='When assigned to carrier/truck/driver', null=True)),
                ('pickup_arrival_at', models.DateTimeField(blank=True, help_text='When truck arrived at pickup facility', null=True)),
                ('pickup_departure_at', models.DateTimeField(blank=True, help_text='When truck departed pickup facility', null=True)),
                ('delivery_arrival_at', models.DateTimeField(blank=True, help_text='When truck arrived at delivery facility', null=True)),
                ('delivery_departure_at', models.DateTimeField(blank=True, help_text='When truck departed delivery facility', null=True)),
                ('delivered_at', models.DateTimeField(blank=True, help_text='When delivery was completed', null=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When load was closed', null=True)),
                ('cancelled_at', models.DateTimeField(blank=True, help_text="When load was cancelled or TONU'd", null=True)),
                ('remarks', models.TextField(blank=True)),
                ('broker', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.broker')),
                ('carrier', models.ForeignKey(blank=True, help_text='Assigned during dispatch', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.carrier')),
                ('delivery_facility', models.ForeignKey(help_text='Receiver/consignee location - contains address details', on_delete=django.db.models.deletion.PROTECT, related_name='delivery_loads', to='tms.facility')),
                ('dispatcher', models.ForeignKey(help_text='Dispatcher who booked this load', on_delete=django.db.models.deletion.PROTECT, related_name='dispatched_loads', to=settings.AUTH_USER_MODEL)),
                ('driver', models.ForeignKey(blank=True, help_text='Assigned during dispatch', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.driver')),
                ('pickup_facility', models.ForeignKey(help_text='Shipper location - contains address details', on_delete=django.db.models.deletion.PROTECT, related_name='pickup_loads', to='tms.facility')),
                ('tracking_agent', models.ForeignKey(blank=True, help_text='Tracking agent assigned after handover from dispatch', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tracked_loads', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Handover',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('special_instructions', models.TextField(blank=True)),
                ('remarks', models.TextField(blank=True)),
                ('from_agent', models.ForeignKey(help_text='Dispatcher who handed over (immutable audit)', on_delete=django.db.models.deletion.PROTECT, related_name='handovers_from', to=settings.AUTH_USER_MODEL)),
                ('to_agent', models.ForeignKey(help_text='Tracking agent assigned to load', on_delete=django.db.models.deletion.PROTECT, related_name='handovers_to', to=settings.AUTH_USER_MODEL)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='handovers', to='tms.load')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='DutyLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('status', models.CharField(choices=[('off_duty', 'Off Duty'), ('sleeper_berth', 'Sleeper Berth'), ('driving', 'Driving'), ('on_duty_not_driving', 'On Duty (Not Driving)')], max_length=25)),
                ('start_time', models.DateTimeField()),
                ('end_time', models.DateTimeField(blank=True, null=True)),
                ('duration', models.DurationField(blank=True, help_text='Auto-calculated from start/end times', null=True)),
                ('current_location', models.CharField(blank=True, help_text="Freeform location (e.g., 'I-80 exit 42, IA')", max_length=200)),
                ('remarks', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_duty_logs', to=settings.AUTH_USER_MODEL)),
                ('driver', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='duty_logs', to='tms.driver')),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='duty_logs', to='tms.load')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Document',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('document_type', models.CharField(choices=[('RC', 'Rate Confirmation'), ('BOL', 'Bill of Lading'), ('POD', 'Proof of Delivery'), ('DETENTION', 'Detention'), ('LUMPER', 'Lumper'), ('TONU', 'Truck Order Not Used'), ('OTHERS', 'Others')], default='OTHERS', max_length=20)),
                ('file', models.FileField(upload_to='documents/%Y/%m/%d/')),
                ('original_filename', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('is_required_for_completion', models.BooleanField(default=False, help_text='Document required to mark load as complete')),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='tms.load')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Appointment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('appointment_type', models.CharField(choices=[('pickup', 'Pickup'), ('delivery', 'Delivery')], max_length=10)),
                ('scheduled_datetime', models.DateTimeField(help_text='Scheduled appointment date and time')),
                ('is_fcfs', models.BooleanField(default=False, help_text='First Come First Serve (no appointment required)')),
                ('confirmation_number', models.CharField(blank=True, max_length=50)),
                ('confirmed_with', models.CharField(blank=True, help_text='Name of person who confirmed', max_length=100)),
                ('created_by', models.ForeignKey(help_text='User who created this appointment', on_delete=django.db.models.deletion.PROTECT, related_name='created_appointments', to=settings.AUTH_USER_MODEL)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='appointments', to='tms.load')),
            ],
            options={
                'ordering': ['scheduled_datetime'],
            },
        ),
        migrations.CreateModel(
            name='Accessorial',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('charge_type', models.CharField(choices=[('detention', 'Detention'), ('layover', 'Layover'), ('tonu', 'TONU (Truck Ordered Not Used)'), ('lumper', 'Lumper Fee'), ('other', 'Other')], max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('description', models.TextField(blank=True)),
                ('detention_start', models.DateTimeField(blank=True, null=True)),
                ('detention_end', models.DateTimeField(blank=True, null=True)),
                ('detention_hours', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('layover_date', models.DateField(blank=True, null=True)),
                ('layover_reason', models.TextField(blank=True)),
                ('approval_status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('denied', 'Denied'), ('paid', 'Paid')], default='pending', max_length=20)),
                ('broker_notified', models.BooleanField(default=False)),
                ('broker_notified_at', models.DateTimeField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_accessorials', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_accessorials', to=settings.AUTH_USER_MODEL)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='accessorials', to='tms.load')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='TrackingUpdate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('current_location', models.CharField(blank=True, help_text="Current location description (e.g., 'I-80 exit 42')", max_length=200)),
                ('tracking_method', models.CharField(choices=[('phone', 'Phone Call'), ('text', 'Text Message'), ('email', 'Email')], max_length=20)),
                ('is_delayed', models.BooleanField(default=False)),
                ('delay_reason', models.CharField(blank=True, choices=[('shipper_delay', 'Shipper - Facility Not Ready'), ('receiver_delay', 'Receiver - Facility Full/Busy'), ('driver_hos', 'Driver - Out of Hours (HOS)'), ('mechanical', 'Driver - Mechanical Breakdown'), ('weather', 'Environmental - Weather/Road Closure'), ('traffic', 'Environmental - Heavy Traffic/Accident'), ('broker_req', 'Broker - Requested Change'), ('doc_error', 'Administrative - Rate Con/Paperwork Error'), ('missed_appt', 'Operational - Driver Missed Appointment')], max_length=20)),
                ('broker_notified', models.BooleanField(default=False)),
                ('broker_notified_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tracking_updates', to='tms.load')),
                ('tracking_agent', models.ForeignKey(help_text='Tracking agent who reported this update (immutable audit)', on_delete=django.db.models.deletion.PROTECT, related_name='tracking_updates', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Truck',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('truck_number', models.CharField(help_text='Internal fleet number', max_length=50)),
                ('trailer_number', models.CharField(blank=True, help_text='Trailer number if applicable', max_length=50)),
                ('vin', models.CharField(blank=True, help_text='Vehicle Identification Number', max_length=17)),
                ('license_plate', models.CharField(help_text='License plate number (required for road operations)', max_length=20)),
                ('equipment_type', models.CharField(choices=[('dry_van', 'Dry Van'), ('reefer', 'Refrigerated (Reefer)'), ('flatbed', 'Flatbed'), ('step_deck', 'Step Deck'), ('power_only', 'Power Only'), ('box_truck', 'Box Truck'), ('other', 'Other')], max_length=20)),
                ('length_feet', models.PositiveIntegerField(default=53, help_text='Trailer length (48 or 53)')),
                ('chassis_no', models.CharField(blank=True, help_text='Chassis/frame number (tractor unit identifier)', max_length=50)),
                ('current_status', models.CharField(choices=[('available', 'Available (Empty)'), ('assigned', 'Assigned to Load'), ('out_of_service', 'Out of Service')], default='available', help_text='Current operational status', max_length=20)),
                ('current_location_city', models.CharField(blank=True, max_length=100)),
                ('current_location_state', models.CharField(blank=True, max_length=2)),
                ('last_location_update', models.DateTimeField(blank=True, null=True)),
                ('truck_has_insurance', models.BooleanField(default=True, help_text='Does this truck have valid insurance?')),
                ('notes', models.TextField(blank=True)),
                ('carrier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trucks', to='tms.carrier')),
            ],
        ),
        migrations.AddField(
            model_name='load',
            name='truck',
            field=models.ForeignKey(blank=True, help_text='Assigned during dispatch', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='loads', to='tms.truck'),
        ),
        migrations.AddField(
            model_name='driver',
            name='current_truck',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='current_driver', to='tms.truck'),
        ),
        migrations.CreateModel(
            name='RescheduleRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('reason', models.CharField(choices=[('shipper_delay', 'Shipper - Facility Not Ready'), ('receiver_delay', 'Receiver - Facility Full/Busy'), ('driver_hos', 'Driver - Out of Hours (HOS)'), ('mechanical', 'Driver - Mechanical Breakdown'), ('weather', 'Environmental - Weather/Road Closure'), ('traffic', 'Environmental - Heavy Traffic/Accident'), ('broker_req', 'Broker - Requested Change'), ('doc_error', 'Administrative - Rate Con/Paperwork Error'), ('missed_appt', 'Operational - Driver Missed Appointment')], help_text='Why is rescheduling needed?', max_length=20)),
                ('consignee_approved', models.BooleanField(default=False, help_text='Has consignee approved? Write contact Details in notes.')),
                ('broker_approved', models.BooleanField(default=False, help_text='Has broker approved?')),
                ('manager_approved', models.BooleanField(default=False, help_text='Has internal manager approved?')),
                ('remarks', models.TextField(blank=True, help_text='Write relevant details here')),
                ('created_by', models.ForeignKey(help_text='Tracking agent who initiated reschedule', on_delete=django.db.models.deletion.PROTECT, related_name='created_reschedules', to=settings.AUTH_USER_MODEL)),
                ('load', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reschedule_requests', to='tms.load')),
                ('new_appointment', models.ForeignKey(help_text='New proposed appointment', on_delete=django.db.models.deletion.PROTECT, related_name='reschedule_requests', to='tms.appointment')),
                ('original_appointment', models.ForeignKey(help_text='Original appointment being rescheduled', on_delete=django.db.models.deletion.PROTECT, related_name='reschedules', to='tms.appointment')),
            ],
            options={
                'constraints': [models.UniqueConstraint(condition=models.Q(('is_active', True)), fields=('original_appointment',), name='one_active_reschedule_per_appointment')],
            },
        ),
        migrations.AddConstraint(
            model_name='truck',
            constraint=models.UniqueConstraint(fields=('carrier', 'truck_number'), name='unique_truck_per_carrier'),
        ),
    ]
